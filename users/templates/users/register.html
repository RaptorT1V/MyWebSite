{% extends 'base.html' %}

{% block content %}
  <h2>Register</h2>

  <!-- Всплывающее сообщение -->
  <div id="popup-message" class="popup-message"></div>

  <form method="post">
    {% csrf_token %}

    <div>
      {{ form.username.label_tag }}<br>
      {{ form.username }}
    </div>
    <div>
      {{ form.email.label_tag }}<br>
      {{ form.email }}
    </div>
    <div>
      {{ form.phone.label_tag }}<br>
      {{ form.phone }}
    </div>
    <div>
      {{ form.password1.label_tag }}<br>
      {{ form.password1 }}
    </div>
    <div>
      {{ form.password2.label_tag }}<br>
      {{ form.password2 }}
    </div>

    <button type="submit">Register</button>

    {% if form.errors %}
    <ul class="errorlist">
      {% for field, errors in form.errors.items %}
        <li><strong>{{ field }}:</strong> {{ errors|striptags }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </form>

  <script>
    // Функция для показа всплывающего сообщения
    function showPopupMessage(message) {
        const popup = document.getElementById('popup-message');
        popup.textContent = message;
        popup.classList.add('show');

        setTimeout(() => {
            popup.classList.remove('show');
        }, 5000); // Сообщение исчезает через 5 секунд
    }

    // Показываем сообщение при ошибке
    {% if form.errors %}
    showPopupMessage("Registration failed. Please correct the errors below.");
    {% endif %}

    // Логика для изменения цвета кнопки при заполнении всех полей
    const form = document.querySelector('form');
    const button = form.querySelector('button');

    form.addEventListener('input', function () {
        const allFieldsFilled = [...form.elements].every(input => input.value);
        if (allFieldsFilled) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });

    // Код для удаления всплывающего сообщения через 5 секунд
    window.addEventListener('DOMContentLoaded', function () {
        var messageBox = document.getElementById('popup-message');

        if (messageBox) {
            // Показываем сообщение и запускаем таймер на удаление блока
            messageBox.classList.add('show');

            setTimeout(function () {
                // Сначала скрываем блок
                messageBox.classList.remove('show');

                // Затем полностью удаляем его из DOM
                setTimeout(function () {
                    messageBox.remove();
                }, 500);  // Дожидаемся окончания анимации скрытия
            }, 5000);  // Через 5 секунд начинаем скрывать
        }
    });
  </script>
{% endblock %}
